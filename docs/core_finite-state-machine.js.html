<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>core/finite-state-machine.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AABB.html">AABB</a><ul class='methods'><li data-type='method'><a href="AABB.html#clone">clone</a></li><li data-type='method'><a href="AABB.html#translate">translate</a></li><li data-type='method'><a href="AABB.html#.distanceManhattan">distanceManhattan</a></li><li data-type='method'><a href="AABB.html#.distanceX">distanceX</a></li><li data-type='method'><a href="AABB.html#.distanceY">distanceY</a></li><li data-type='method'><a href="AABB.html#.from">from</a></li><li data-type='method'><a href="AABB.html#.overlapX">overlapX</a></li><li data-type='method'><a href="AABB.html#.overlapY">overlapY</a></li></ul></li><li><a href="Actor.html">Actor</a><ul class='methods'><li data-type='method'><a href="Actor.html#$setListener">$setListener</a></li><li data-type='method'><a href="Actor.html#$trigger">$trigger</a></li><li data-type='method'><a href="Actor.html#addListener">addListener</a></li><li data-type='method'><a href="Actor.html#addSound">addSound</a></li><li data-type='method'><a href="Actor.html#addVibration">addVibration</a></li><li data-type='method'><a href="Actor.html#getComponent">getComponent</a></li><li data-type='method'><a href="Actor.html#hasCollider">hasCollider</a></li><li data-type='method'><a href="Actor.html#hasComponent">hasComponent</a></li><li data-type='method'><a href="Actor.html#hasSprite">hasSprite</a></li><li data-type='method'><a href="Actor.html#onAfterRemove">onAfterRemove</a></li><li data-type='method'><a href="Actor.html#onBeforeRemove">onBeforeRemove</a></li><li data-type='method'><a href="Actor.html#onCollide">onCollide</a></li><li data-type='method'><a href="Actor.html#onCollideEnter">onCollideEnter</a></li><li data-type='method'><a href="Actor.html#onCollideLeave">onCollideLeave</a></li><li data-type='method'><a href="Actor.html#onCreate">onCreate</a></li><li data-type='method'><a href="Actor.html#onSetVisible">onSetVisible</a></li><li data-type='method'><a href="Actor.html#onSetZIndex">onSetZIndex</a></li><li data-type='method'><a href="Actor.html#onSoundFinish">onSoundFinish</a></li><li data-type='method'><a href="Actor.html#onTick">onTick</a></li><li data-type='method'><a href="Actor.html#onTranslate">onTranslate</a></li><li data-type='method'><a href="Actor.html#removeCollider">removeCollider</a></li><li data-type='method'><a href="Actor.html#removeComponent">removeComponent</a></li><li data-type='method'><a href="Actor.html#removeSound">removeSound</a></li><li data-type='method'><a href="Actor.html#removeSounds">removeSounds</a></li><li data-type='method'><a href="Actor.html#removeSprite">removeSprite</a></li><li data-type='method'><a href="Actor.html#removeVibration">removeVibration</a></li><li data-type='method'><a href="Actor.html#removeVibrations">removeVibrations</a></li><li data-type='method'><a href="Actor.html#setCollider">setCollider</a></li><li data-type='method'><a href="Actor.html#setComponent">setComponent</a></li><li data-type='method'><a href="Actor.html#setIdentifier">setIdentifier</a></li><li data-type='method'><a href="Actor.html#setSprite">setSprite</a></li><li data-type='method'><a href="Actor.html#setVisible">setVisible</a></li><li data-type='method'><a href="Actor.html#setZIndex">setZIndex</a></li><li data-type='method'><a href="Actor.html#translate">translate</a></li><li data-type='method'><a href="Actor.html#translateTo">translateTo</a></li><li data-type='method'><a href="Actor.html#trigger">trigger</a></li></ul></li><li><a href="Collider.html">Collider</a></li><li><a href="Engine.html">Engine</a><ul class='methods'><li data-type='method'><a href="Engine.html#createStage">createStage</a></li><li data-type='method'><a href="Engine.html#getInput">getInput</a></li><li data-type='method'><a href="Engine.html#getInputAnalog">getInputAnalog</a></li><li data-type='method'><a href="Engine.html#getTranslationFromScreen">getTranslationFromScreen</a></li><li data-type='method'><a href="Engine.html#hasAssetLoaded">hasAssetLoaded</a></li><li data-type='method'><a href="Engine.html#initiate">initiate</a></li><li data-type='method'><a href="Engine.html#preloadStage">preloadStage</a></li><li data-type='method'><a href="Engine.html#removePointerNative">removePointerNative</a></li><li data-type='method'><a href="Engine.html#setColor">setColor</a></li><li data-type='method'><a href="Engine.html#setResolution">setResolution</a></li><li data-type='method'><a href="Engine.html#terminate">terminate</a></li><li data-type='method'><a href="Engine.html#tick">tick</a></li></ul></li><li><a href="EventGamepad.html">EventGamepad</a></li><li><a href="EventGamepadAnalog.html">EventGamepadAnalog</a></li><li><a href="EventGamepadDigital.html">EventGamepadDigital</a></li><li><a href="EventPointerAnalog.html">EventPointerAnalog</a></li><li><a href="EventPointerDigital.html">EventPointerDigital</a></li><li><a href="ExtensionGamepad.html">ExtensionGamepad</a><ul class='methods'><li data-type='method'><a href="ExtensionGamepad.html#.activate">activate</a></li></ul></li><li><a href="ExtensionPointer.html">ExtensionPointer</a><ul class='methods'><li data-type='method'><a href="ExtensionPointer.html#.activate">activate</a></li></ul></li><li><a href="FiniteStateMachine.html">FiniteStateMachine</a><ul class='methods'><li data-type='method'><a href="FiniteStateMachine.html#initiate">initiate</a></li><li data-type='method'><a href="FiniteStateMachine.html#tick">tick</a></li></ul></li><li><a href="Loop.html">Loop</a><ul class='methods'><li data-type='method'><a href="Loop.html#initiate">initiate</a></li><li data-type='method'><a href="Loop.html#terminate">terminate</a></li></ul></li><li><a href="Preloadable.html">Preloadable</a></li><li><a href="Quaternion.html">Quaternion</a></li><li><a href="Queue.html">Queue</a><ul class='methods'><li data-type='method'><a href="Queue.html#clear">clear</a></li><li data-type='method'><a href="Queue.html#pop">pop</a></li><li data-type='method'><a href="Queue.html#push">push</a></li></ul></li><li><a href="Shader.html">Shader</a></li><li><a href="Sound.html">Sound</a></li><li><a href="Sprite.html">Sprite</a></li><li><a href="Stack.html">Stack</a><ul class='methods'><li data-type='method'><a href="Stack.html#clear">clear</a></li><li data-type='method'><a href="Stack.html#pop">pop</a></li><li data-type='method'><a href="Stack.html#push">push</a></li></ul></li><li><a href="Stage.html">Stage</a><ul class='methods'><li data-type='method'><a href="Stage.html#createActor">createActor</a></li><li data-type='method'><a href="Stage.html#hasActor">hasActor</a></li><li data-type='method'><a href="Stage.html#onCreate">onCreate</a></li><li data-type='method'><a href="Stage.html#removeActor">removeActor</a></li><li data-type='method'><a href="Stage.html#removeActors">removeActors</a></li><li data-type='method'><a href="Stage.html#setPointOfView">setPointOfView</a></li></ul></li><li><a href="State.html">State</a><ul class='methods'><li data-type='method'><a href="State.html#getState">getState</a></li><li data-type='method'><a href="State.html#setState">setState</a></li><li data-type='method'><a href="State.html#unwatchAll">unwatchAll</a></li><li data-type='method'><a href="State.html#unwatchState">unwatchState</a></li><li data-type='method'><a href="State.html#watchState">watchState</a></li></ul></li><li><a href="System.html">System</a><ul class='methods'><li data-type='method'><a href="System.html#initiate">initiate</a></li><li data-type='method'><a href="System.html#onInitiate">onInitiate</a></li><li data-type='method'><a href="System.html#onTerminate">onTerminate</a></li><li data-type='method'><a href="System.html#onTick">onTick</a></li><li data-type='method'><a href="System.html#terminate">terminate</a></li><li data-type='method'><a href="System.html#tick">tick</a></li></ul></li><li><a href="SystemActor.html">SystemActor</a><ul class='methods'><li data-type='method'><a href="SystemActor.html#onTick">onTick</a></li></ul></li><li><a href="SystemAudio.html">SystemAudio</a><ul class='methods'><li data-type='method'><a href="SystemAudio.html#hasAssetLoaded">hasAssetLoaded</a></li><li data-type='method'><a href="SystemAudio.html#loadAudio">loadAudio</a></li><li data-type='method'><a href="SystemAudio.html#onInitiate">onInitiate</a></li><li data-type='method'><a href="SystemAudio.html#onTerminate">onTerminate</a></li><li data-type='method'><a href="SystemAudio.html#onTick">onTick</a></li></ul></li><li><a href="SystemCollision.html">SystemCollision</a><ul class='methods'><li data-type='method'><a href="SystemCollision.html#onInitiate">onInitiate</a></li><li data-type='method'><a href="SystemCollision.html#onTick">onTick</a></li></ul></li><li><a href="SystemInput.html">SystemInput</a><ul class='methods'><li data-type='method'><a href="SystemInput.html#getInput">getInput</a></li><li data-type='method'><a href="SystemInput.html#getInputAnalog">getInputAnalog</a></li><li data-type='method'><a href="SystemInput.html#onInitiate">onInitiate</a></li><li data-type='method'><a href="SystemInput.html#onTerminate">onTerminate</a></li><li data-type='method'><a href="SystemInput.html#onTick">onTick</a></li></ul></li><li><a href="SystemRender.html">SystemRender</a><ul class='methods'><li data-type='method'><a href="SystemRender.html#$setFocus">$setFocus</a></li><li data-type='method'><a href="SystemRender.html#getTranslationFromScreen">getTranslationFromScreen</a></li><li data-type='method'><a href="SystemRender.html#hasAssetLoaded">hasAssetLoaded</a></li><li data-type='method'><a href="SystemRender.html#loadTexture">loadTexture</a></li><li data-type='method'><a href="SystemRender.html#onInitiate">onInitiate</a></li><li data-type='method'><a href="SystemRender.html#onTerminate">onTerminate</a></li><li data-type='method'><a href="SystemRender.html#onTick">onTick</a></li><li data-type='method'><a href="SystemRender.html#removePointerNative">removePointerNative</a></li><li data-type='method'><a href="SystemRender.html#setColor">setColor</a></li><li data-type='method'><a href="SystemRender.html#setResolution">setResolution</a></li></ul></li><li><a href="SystemVibration.html">SystemVibration</a><ul class='methods'><li data-type='method'><a href="SystemVibration.html#onInitiate">onInitiate</a></li><li data-type='method'><a href="SystemVibration.html#onTerminate">onTerminate</a></li><li data-type='method'><a href="SystemVibration.html#onTick">onTick</a></li></ul></li><li><a href="Timeline.html">Timeline</a><ul class='methods'><li data-type='method'><a href="Timeline.html#seekName">seekName</a></li><li data-type='method'><a href="Timeline.html#seekTimecode">seekTimecode</a></li><li data-type='method'><a href="Timeline.html#tick">tick</a></li></ul></li><li><a href="TimelineKeyframe.html">TimelineKeyframe</a></li><li><a href="Vector2.html">Vector2</a><ul class='methods'><li data-type='method'><a href="Vector2.html#add">add</a></li><li data-type='method'><a href="Vector2.html#clone">clone</a></li><li data-type='method'><a href="Vector2.html#equal">equal</a></li><li data-type='method'><a href="Vector2.html#length">length</a></li><li data-type='method'><a href="Vector2.html#multiply">multiply</a></li><li data-type='method'><a href="Vector2.html#negate">negate</a></li><li data-type='method'><a href="Vector2.html#normalize">normalize</a></li><li data-type='method'><a href="Vector2.html#rotate">rotate</a></li><li data-type='method'><a href="Vector2.html#scale">scale</a></li><li data-type='method'><a href="Vector2.html#subtract">subtract</a></li><li data-type='method'><a href="Vector2.html#.from">from</a></li></ul></li><li><a href="Vector3.html">Vector3</a><ul class='methods'><li data-type='method'><a href="Vector3.html#add">add</a></li><li data-type='method'><a href="Vector3.html#clone">clone</a></li><li data-type='method'><a href="Vector3.html#equal">equal</a></li><li data-type='method'><a href="Vector3.html#length">length</a></li><li data-type='method'><a href="Vector3.html#multiply">multiply</a></li><li data-type='method'><a href="Vector3.html#negate">negate</a></li><li data-type='method'><a href="Vector3.html#normalize">normalize</a></li><li data-type='method'><a href="Vector3.html#rotate">rotate</a></li><li data-type='method'><a href="Vector3.html#scale">scale</a></li><li data-type='method'><a href="Vector3.html#subtract">subtract</a></li><li data-type='method'><a href="Vector3.html#.from">from</a></li></ul></li><li><a href="Vibration.html">Vibration</a></li></ul><h3>Modules</h3><ul><li><a href="module-COLLIDERTYPES.html">COLLIDERTYPES</a></li><li><a href="module-CONTENTTYPES.html">CONTENTTYPES</a></li><li><a href="module-EVENTCODES_GAMEPADS_PLAYSTATION.html">EVENTCODES/GAMEPADS/PLAYSTATION</a></li><li><a href="module-EVENTCODES_GAMEPADS_XBOX.html">EVENTCODES/GAMEPADS/XBOX</a></li><li><a href="module-EVENTCODES_KEYBOARDS_AZERTY.html">EVENTCODES/KEYBOARDS/AZERTY</a></li><li><a href="module-EVENTCODES_KEYBOARDS_QWERTY.html">EVENTCODES/KEYBOARDS/QWERTY</a></li><li><a href="module-EVENTCODES_POINTER.html">EVENTCODES/POINTER</a></li><li><a href="module-FACTORIES.html">FACTORIES</a><ul class='methods'><li data-type='method'><a href="module-FACTORIES.html#.ActorWithPreloadables">ActorWithPreloadables</a></li><li data-type='method'><a href="module-FACTORIES.html#.PreloadableSound">PreloadableSound</a></li><li data-type='method'><a href="module-FACTORIES.html#.PreloadableTexture">PreloadableTexture</a></li><li data-type='method'><a href="module-FACTORIES.html#.StageWithPreloadables">StageWithPreloadables</a></li></ul></li><li><a href="module-MATHEMATICS.html">MATHEMATICS</a></li><li><a href="module-MEDIATYPES.html">MEDIATYPES</a></li><li><a href="module-STORAGE.html">STORAGE</a><ul class='methods'><li data-type='method'><a href="module-STORAGE.html#.get">get</a></li><li data-type='method'><a href="module-STORAGE.html#.has">has</a></li><li data-type='method'><a href="module-STORAGE.html#.remove">remove</a></li><li data-type='method'><a href="module-STORAGE.html#.set">set</a></li></ul></li><li><a href="module-UTILS.html">UTILS</a><ul class='methods'><li data-type='method'><a href="module-UTILS.html#.deduplicate">deduplicate</a></li><li data-type='method'><a href="module-UTILS.html#.extract">extract</a></li><li data-type='method'><a href="module-UTILS.html#.frame">frame</a></li><li data-type='method'><a href="module-UTILS.html#.ready">ready</a></li><li data-type='method'><a href="module-UTILS.html#.sleep">sleep</a></li><li data-type='method'><a href="module-UTILS.html#.uuid">uuid</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">core/finite-state-machine.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Creates finite state machines.
 * @template {string} TypeGeneric The generic type of the names of a state.
 *
 * @example
 *
 * const toggle = new FiniteStateMachine([
 *
 *     {
 *         $state: 'ON',
 *         $transitions: [{
 *
 *             $state: 'OFF',
 *             $condition: ({$timer}) => ($timer >= 1000)
 *         }]
 *     },
 *     {
 *         $state: 'OFF',
 *         $transitions: [{
 *
 *             $state: 'ON',
 *             $condition: ({$timer}) => ($timer >= 1000)
 *         }]
 *     }
 * ]);
 *
 * toggle.tick(timetick);
 */
class FiniteStateMachine {

    /**
     * @callback TypeStateHandlerEnter A state entering handler.
     * @param {Object} $parameters The given parameters.
     * @param {TypeGeneric} $parameters.$previous The previous state.
     * @returns {void}
     * @protected
     *
     * @memberof FiniteStateMachine
     */

    /**
     * @callback TypeStateHandlerLeave A state leaving handler.
     * @param {Object} $parameters The given parameters.
     * @param {number} $parameters.$timer The timer of the current state.
     * @param {TypeGeneric} $parameters.$next The next state.
     * @returns {void}
     * @protected
     *
     * @memberof FiniteStateMachine
     */

    /**
     * @callback TypeStateHandlerTick A state updating handler.
     * @param {Object} $parameters The given parameters.
     * @param {number} $parameters.$timetick The tick duration (in ms).
     * @param {number} $parameters.$timer The timer of the current state.
     * @returns {void}
     * @protected
     *
     * @memberof FiniteStateMachine
     */

    /**
     * @callback TypeStateTransitionCondition A state transition condition.
     * @param {Object} $parameters The given parameters.
     * @param {TypeGeneric} $parameters.$previous The previous state.
     * @param {number} $parameters.$timer The timer of the current state.
     * @returns {boolean}
     * @protected
     *
     * @memberof FiniteStateMachine
     */

    /**
     * @typedef {Object} TypeStateTransition A transition to a state.
     * @property {TypeStateTransitionCondition} TypeStateTransition.$condition The condition to transition to given state.
     * @property {TypeGeneric} TypeStateTransition.$state The given state to transition to.
     * @protected
     *
     * @memberof FiniteStateMachine
     */

    /**
     * @typedef {Object} TypeState A state.
     * @property {TypeGeneric} TypeState.$state The name of the state.
     * @property {TypeStateHandlerEnter} [TypeState.$onEnter] The handler to execute when entering the state.
     * @property {TypeStateHandlerLeave} [TypeState.$onLeave] The handler to execute when leaving the state.
     * @property {TypeStateHandlerTick} [TypeState.$onTick] The handler to execute when updating the state.
     * @property {Array&lt;TypeStateTransition>} [TypeState.$transitions] The transitions to given states.
     * @protected
     *
     * @memberof FiniteStateMachine
     */

    /**
     * Stores the initiated status.
     * @type {boolean}
     * @private
     */
    $initiated;

    /**
     * Stores the previous state.
     * @type {TypeState}
     * @private
     */
    $previous;

    /**
     * Stores the current state.
     * @type {TypeState}
     * @private
     */
    $state;

    /**
     * Stores the states.
     * @type {Map&lt;TypeGeneric, TypeState>}
     * @private
     */
    $states;

    /**
     * Stores the timer of the current state.
     * @type {number}
     * @private
     */
    $timer;

    /**
     * Gets the name of the current state.
     * @type {TypeGeneric}
     * @public
     */
    get state() {

        return this.$state.$state;
    }

    /**
     * Gets the initiated status.
     * @type {boolean}
     * @public
     */
    get initiated() {

        return this.$initiated;
    }

    /**
     * Creates a new finite state machine.
     * @param {Array&lt;TypeState>} $data The representation of the finite state machine.
     */
    constructor($data) {

        this.$initiated = false;
        this.$states = new Map();
        this.$timer = 0;

        $data.forEach(($state) => {

            this.$states.set($state.$state, $state);
        });
    }

    /**
     * Initiates the finite state machine.
     * @param {TypeGeneric} $state The name of the state to initiate.
     * @public
     */
    initiate($state) {

        if (this.$initiated === true) {

            return;
        }

        this.$previous = this.$state
        this.$state = this.$states.get($state);

        if (typeof this.$state.$onEnter === 'function') {

            this.$state.$onEnter({$previous: undefined});
        }

        this.$initiated = true;
    }

    /**
     * Updates the finite state machine by one tick update.
     * @param {number} $timetick The tick duration (in ms).
     * @public
     */
    tick($timetick) {

        if (this.$initiated === false) {

            return;
        }

        this.$timer += $timetick;

        if (typeof this.$state.$onTick === 'function') {

            this.$state.$onTick({$timetick: $timetick, $timer: this.$timer});
        }

        const transitions = this.$state.$transitions;

        if (Array.isArray(transitions) === false) {

            return;
        }

        for (let $transition of transitions) {

            let previous;

            if (typeof this.$previous !== 'undefined') {

                previous = this.$previous.$state;
            }

            const current = this.$state.$state;
            const next = $transition.$state;

            if ($transition.$condition({$previous: previous, $timer: this.$timer}) === true) {

                if (typeof this.$state.$onLeave === 'function') {

                    this.$state.$onLeave({$timer: this.$timer, $next: next});
                }

                this.$timer = 0;

                this.$previous = this.$state;
                this.$state = this.$states.get(next);

                if (typeof this.$state.$onEnter === 'function') {

                    this.$state.$onEnter({$previous: current});
                }

                this.tick(0);

                break;
            }
        }
    }
}

export {

    FiniteStateMachine
};

export default FiniteStateMachine;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Mon Apr 21 2025 14:24:58 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
